services:
  # =========================
  # Telegram Music Bot (Worker)
  # =========================
  - type: web
    name: telegram-music-bot
    runtime: python
    plan: free
    region: oregon
    branch: main

    buildCommand: pip install -r requirements.txt
    startCommand: python main.py

    envVars:
      - key: API_ID
        sync: false
      - key: API_HASH
        sync: false
      - key: BOT_TOKEN
        sync: false
      - key: SESSION_STRING
        sync: false
      - key: OWNER_ID
        sync: false

      # Redis auto connection
      - key: REDIS_URL
        fromService:
          type: redis
          name: music-bot-redis
          property: connectionString

      # Optional error monitoring
      - key: SENTRY_DSN
        sync: false

    autoDeploy: true
    numInstances: 1

  # =========================
  # Redis Service
  # =========================
  - type: redis
    name: music-bot-redis
    plan: free
    region: oregon

    ipAllowList:
      - source: 0.0.0.0/0
        description: Allow all
